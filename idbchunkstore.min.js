(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var r;if(typeof window!=="undefined"){r=window}else if(typeof global!=="undefined"){r=global}else if(typeof self!=="undefined"){r=self}else{r=this}r.IdbChunkStore=e()}})(function(){var e,r,t;return function e(r,t,n){function o(u,s){if(!t[u]){if(!r[u]){var c=typeof require=="function"&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var a=t[u]={exports:{}};r[u][0].call(a.exports,function(e){var t=r[u][1][e];return o(t?t:e)},a,a.exports,e,r,t,n)}return t[u].exports}var i=typeof require=="function"&&require;for(var u=0;u<n.length;u++)o(n[u]);return o}({1:[function(e,r,t){r.exports=o;var n=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function o(e,r){var t=this;if(typeof e!=="string")throw new Error("A name must be supplied of type string");if(!(this instanceof o))return new o(e,r);if(!r)r={};t._db=null;t._queue=[];var i=n.open(e);i.onerror=function(e){u(e,r.onerror)};i.onsuccess=function(e){t._db=e.target.result;t._drainQueue();if(r.onready)r.onready()};i.onupgradeneeded=function(e){var r=e.target.result;r.createObjectStore("kv")}}o.prototype.get=function(e,r){var t=this;var n=i(r);if(!t._db){t._queue.push({type:"get",key:e,cb:n.cb})}else if(Array.isArray(e)){var o=[];var s=false;var c=0;e.forEach(function(r,i){t.get(e[i],function(r,t){if(s)return;if(r){s=true;n.cb(r)}o[i]=t;c++;if(c===e.length)n.cb(null,o)})})}else{var f=t._db.transaction("kv","readonly");var a=f.objectStore("kv").get(e);a.onsuccess=function(e){n.cb(null,e.target.result)};f.onerror=function(e){u(e,n.cb)}}return n.promise};o.prototype.set=function(e,r,t){var n=this;var o=i(t);if(!n._db){n._queue.push({type:"set",key:e,value:r,cb:o.cb})}else{var s=n._db.transaction("kv","readwrite");var c=s.objectStore("kv").put(r,e);c.onsuccess=function(){o.cb(null)};s.onerror=function(e){u(e,o.cb)}}return o.promise};o.prototype.json=function(e){var r=this;var t=i(e);if(!r._db){r._queue.push({type:"json",cb:t.cb})}else{var n=r._db.transaction("kv","readonly");var o=n.objectStore("kv").openCursor();var s={};o.onsuccess=function(e){var r=e.target.result;if(r){s[r.key]=r.value;r.continue()}else{t.cb(null,s)}};n.onerror=function(e){u(e,t.cb)}}return t.promise};o.prototype.keys=function(e){var r=this;var t=i(e);if(!r._db){r._queue.push({type:"keys",cb:t.cb})}else{var n=r._db.transaction("kv","readonly");var o=n.objectStore("kv").openCursor();var s=[];o.onsuccess=function(e){var r=e.target.result;if(r){s.push(r.key);r.continue()}else{t.cb(null,s)}};n.onerror=function(e){u(e,t.cb)}}return t.promise};o.prototype.remove=function(e,r){var t=this;var n=i(r);if(!t._db){t._queue.push({type:"remove",key:e,cb:n.cb})}else{var o=t._db.transaction("kv","readwrite");var s=o.objectStore("kv").delete(e);s.onsuccess=function(e){n.cb(null)};o.onerror=function(e){u(e,n.cb)}}return n.promise};o.prototype.clear=function(e){var r=this;var t=i(e);if(!r._db){r._queue.push({type:"clear",cb:t.cb})}else{var n=r._db.transaction("kv","readwrite");var o=n.objectStore("kv").clear();o.onsuccess=function(e){t.cb(null)};n.onerror=function(e){u(e,t.cb)}}return t.promise};o.prototype.count=function(e){var r=this;var t=i(e);if(!r._db){r._queue.push({type:"count",cb:t.cb})}else{var n=r._db.transaction("kv","readonly");var o=n.objectStore("kv").count();o.onsuccess=function(e){t.cb(null,e.target.result)};n.onerror=function(e){u(e,t.cb)}}return t.promise};o.prototype.add=function(e,r,t){var n=this;var o=i(t);if(!n._db){n._queue.push({type:"add",key:e,value:r,cb:o.cb})}else{var s=n._db.transaction("kv","readwrite");var c=s.objectStore("kv").add(r,e);c.onsuccess=function(e){o.cb(null)};s.onerror=function(e){u(e,o.cb)}}return o.promise};o.prototype._drainQueue=function(){var e=this;for(var r=0;r<e._queue.length;r++){var t=e._queue[r];if(t.type==="get"){e.get(t.key,t.cb)}else if(t.type==="set"){e.set(t.key,t.value,t.cb)}else if(t.type==="json"){e.json(t.cb)}else if(t.type==="keys"){e.keys(t.cb)}else if(t.type==="remove"){e.remove(t.key,t.cb)}else if(t.type==="clear"){e.clear(t.cb)}else if(t.type==="count"){e.count(t.cb)}else if(t.type==="add"){e.add(t.key,t.value,t.cb)}}e._queue=null};function i(e){var r={cb:e};if(typeof Promise==="function"&&e==null){r.promise=new Promise(function(e,t){r.cb=function(r,n){if(r)return t(r);else return e(n)}})}if(!r.cb)r.cb=function e(){};return r}function u(e,r){var t=new Error("IDB error");t.event=e;if(r){r(t)}else{throw t}}},{}],"/":[function(e,r,t){r.exports=o;var n=e("idb-kv-store");function o(e,r){var t=this;if(!(this instanceof o))return new o(e);if(!r)r={};t.chunkLength=e;t._store=new n(r.name||Math.round(9e16*Math.random()))}o.prototype.put=function(e,r,t){var n=this;if(!n._store)throw new Error("Store is closed");if(typeof e!=="number")throw new Error("index must be a number");n._store.set(e,r,t)};o.prototype.get=function(e,r,t){var n=this;if(!n._store)throw new Error("Store is closed");if(typeof e!=="number")throw new Error("index must be a number");if(typeof r==="function")return n.get(e,null,r);if(typeof t!=="function")throw new Error("cb must be a function");if(!r)r={};n._store.get(e,t)};o.prototype.close=function(e){var r=this;if(!r._store)throw new Error("Store is closed");r._store=null;if(e)setTimeout(e,0,null)};o.prototype.destroy=function(e){var r=this;if(!r._store)throw new Error("Store is closed");var t=r._store;r._store=null;t.clear(e)}},{"idb-kv-store":1}]},{},[])("/")});
